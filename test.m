
% density_list = zeros(10);
% for i = 1:5
%     N = i*20+80;
%     density_list(i) = findCrystalDensity(N,3);
% end

% N = 500
% alpha = 0.3: ionCloud1
% alpha = 1: ionCloud2
% alpha = 3: ionCloud3
% N = 500;
% ionCloud1 = crystal_graphs_energy(N,0.6614,0.1693,0,0);
% ionCloud2 = crystal_graphs_energy(N,0.3334,0.3333,0,0);
% ionCloud3 = crystal_graphs_energy(N,0.1084,0.4456,0,0);
% 
% for i = 1:N
%     if any(ionCloud1(i,:)>3)
%         ionCloud1(i,:) = [];
%     end
%     if any(ionCloud2(i,:)>3)
%         ionCloud2(i,:) = [];
%     end
%     if any(ionCloud3(i,:)>3)
%         ionCloud3(i,:) = [];
%     end
% end
% 
% fig = figure;
% subplot(1,3,1)
% plot3(ionCloud1(:,1),ionCloud1(:,2),ionCloud1(:,3),'b*','MarkerSize',4);
% subplot(1,3,2)
% plot3(ionCloud2(:,1),ionCloud2(:,2),ionCloud2(:,3),'b*','MarkerSize',4);
% subplot(1,3,3)
% plot3(ionCloud3(:,1),ionCloud3(:,2),ionCloud3(:,3),'b*','MarkerSize',4);
% 
%         
% 
% k = 20;
% N = 50;
% separation = zeros(k,1);
% omega_z = 0.334;
% omega_1 = 0.333;
% omega_r = linspace(-omega_1+0.01,omega_1-0.01,k);
% for i = 1:k
%     positions = crystal_graphs_energy(N,omega_z,omega_1-omega_r(i),0,0);
%     distance = dist(positions,N);
%     separation(i) = mean(min(distance));
% end
% 
% 
% function Distance = dist(positions,N)
% Distance = inf(N,N);
% for i = 1:N
%     for j = i+1:N
%         Distance(i,j) = sqrt(sum((positions(i,:)-positions(j,:)).^2));
%         Distance(j,i) = Distance(i,j);
%     end
% end
% end
% 
% N = 300
% alpha = 0.3
% 
% [EigValues,EigVectors,positions] = findNormalModes(N,alpha);

N = 100;
% alpha = 1;
% [EigValues,EigVectors,positions] = findNormalModes(N,alpha);

rotating_vectors = reshape(EigVectors(:,162),[N,3]);
% radial = sqrt(sum(positions(:,1:2).^2,2));
position_length = sqrt(sum(positions.^2,2));
b = [1,0,0];
b_length = sqrt(sum(b.^2));
b = repelem(b,N,1);
cross_product = cross(b,positions);
c = sqrt(sum(cross_product.^2,2))/b_length;
rotating_amplitude = sqrt(sum(rotating_vectors.^2,2));
[p,r] = linefit(c,rotating_amplitude)

% breathing_vectors = reshape(EigVectors(:,1),[N,3]);
% breathing_radial = sqrt(sum(breathing_vectors(:,1:2).^2,2));
% breathing_axial = abs(breathing_vectors(:,3));
% breathing_amplitude = sqrt(sum(breathing_vectors.^2,2));
% radial = sqrt(sum(positions(:,1:2).^2,2));
% radius = sqrt(sum(positions.^2,2));
% axial = abs(positions(:,3));
% % [p,r] = linefit(radius,breathing_amplitude)
% [p,r] = linefit(radial,breathing_radial)
% mask = radial < 8;
% [p,r] = linefit(radial(mask), breathing_radial(mask))
% scatter(radial,breathing_radial)
% hold on
% [p,S] = polyfit(radial(mask), breathing_radial(mask),1);
% R = 1 - (S.normr/norm(breathing_radial(mask) - mean(breathing_radial(mask))))^2;
% f = polyval(p,radial(mask));
% plot(radial(mask), f, '-')
% hold off
% legend('data','linear fit','FontSize',20)
% set(gca,'Box','on','FontSize',15)
% % scatter(radius,breathing_amplitude)
% xlabel('d')
% ylabel('amplitude')
% set(gca,'Box','on')
% x = positions(:,1);
% y = positions(:,2);
% z = positions(:,3);
% u = breathing_vectors(:,1);
% v = breathing_vectors(:,2);
% w = breathing_vectors(:,3);
% fig = plot3(x,y,z,'b*','MarkerSize',4);
% hold on
% quiver3(x,y,z,u,v,w,0.5,'r');
% hold off
% axis equal
% axisMin = min(positions(:))-0.5;
% axisMax = max(positions(:))+0.5;
% axis([axisMin axisMax axisMin axisMax axisMin axisMax])
% grid on
% scatter(radius,breathing_amplitude)
% scatter(abs(positions(:,3)),breathing_amplitude)
% xlabel('|z|')
% ylabel('amplitude')
% set(gca,'Box','on')


% alpha = 3
% N_list = [2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25	26	27	28	29	30	31	32	33	34	35	36	37	38	39	40	41	42	43	44	45	46	47	48	49	50	52	54	56	58	60	62	64	66	68	70	72	74	76	78	80	82	84	86	88	90	92	94	96	98	100	102	104	106	108	110	112	114	116	118	120	122	124	126	128	130	132	134	136	138	140	142	144	146	148	150	175	200	250	300	350	400	500 1000];
% omega = [0.32613	0.32613 	0.57525	0.8860283141	0.88264	0.9042024686	0.9049076011	0.9120700692	0.9114799122	0.9252059352	0.9244029181	0.9326068417	0.9428167114	0.9484856268	0.9467745785	0.9485739875	0.9505668387	0.954058517	0.955507948	0.9584452367	0.9597943872	0.9616801727	0.9630630733	0.9640151418	0.964510992	0.9662464693	0.9676542271	0.9698409726	0.9699832622	0.9707876394	0.9728459456	0.9739161935	0.9737901719	0.9752031076	0.976012426	0.9764185331	0.9766519308	0.9772665207	0.9780077371	0.9784750736	0.9793654685	0.9801433063	0.9797840364	0.9809244869	0.9807125278	0.9820666279	0.9815411916	0.9820661322	0.9819967574	0.98258801	0.9833117311	0.9828273288	0.9834796841	0.9840551009	0.985070392	0.9856149236	0.9847685875	0.9846638241	0.9858901101	0.985494579	0.986280088	0.9869597903	0.9865908371	0.9873287812	0.9873405176	0.9877785445	0.9876320986	0.987929887	0.9881829444	0.9884727575	0.9884213669	0.9885586548	0.9887558913	0.9886056835	0.9893454482	0.9895319891	0.9898891402	0.9894460591	0.9895955866	0.9900576759	0.9902207659	0.9897235574	0.9906096648	0.990490724	0.9904942693	0.9903916617	0.9908415827	0.9908166755	0.990471389	0.9910745093	0.9914149284	0.9910821403	0.9911772464	0.9914838895	0.9915689274	0.9916292124	0.9916743667	0.9920458981	0.9916988201	0.9924455881	0.9933106521	0.994099084	0.9946658013	0.9951965183	0.9955953614	0.9964070007 0.9976];

% N_3d = [5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25	26	27	28	29	30	31	32	33	34	35	36	37	38	39	40	41	42	43	44	45	46	47	48	49	50	52	54	56	58	60	62	64	66	68	70	72	74	76	78	80	82	84	86	88	90	92	94	96	98	100	102	104	106	108	110	112	114	116	118	120	122	124	126	128	130	132	134	136	138	140	142	144	146	148	150	175	200	250	300	350	400	500];
% omega_3d = [0.8860283141	0.88264	0.9042024686	0.9049076011	0.9120700692	0.9114799122	0.9252059352	0.9244029181	0.9326068417	0.9428167114	0.9484856268	0.9467745785	0.9485739875	0.9505668387	0.954058517	0.955507948	0.9584452367	0.9597943872	0.9616801727	0.9630630733	0.9640151418	0.964510992	0.9662464693	0.9676542271	0.9698409726	0.9699832622	0.9707876394	0.9728459456	0.9739161935	0.9737901719	0.9752031076	0.976012426	0.9764185331	0.9766519308	0.9772665207	0.9780077371	0.9784750736	0.9793654685	0.9801433063	0.9797840364	0.9809244869	0.9807125278	0.9820666279	0.9815411916	0.9820661322	0.9819967574	0.98258801	0.9833117311	0.9828273288	0.9834796841	0.9840551009	0.985070392	0.9856149236	0.9847685875	0.9846638241	0.9858901101	0.985494579	0.986280088	0.9869597903	0.9865908371	0.9873287812	0.9873405176	0.9877785445	0.9876320986	0.987929887	0.9881829444	0.9884727575	0.9884213669	0.9885586548	0.9887558913	0.9886056835	0.9893454482	0.9895319891	0.9898891402	0.9894460591	0.9895955866	0.9900576759	0.9902207659	0.9897235574	0.9906096648	0.990490724	0.9904942693	0.9903916617	0.9908415827	0.9908166755	0.990471389	0.9910745093	0.9914149284	0.9910821403	0.9911772464	0.9914838895	0.9915689274	0.9916292124	0.9916743667	0.9920458981	0.9916988201	0.9924455881	0.9933106521	0.994099084	0.9946658013	0.9951965183	0.9955953614	0.9964070007];

%alpha = 0.3
% N_list = [2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25	26	27	28	29	30	31	32	33	34	35	36	37	38	39	40	41	42	43	44	45	46	47	48	49	50	51	53	55	57	59	60	61	63	65	67	69	70	71	73	75	77	79	80	81	83	85	87	89	90	91	93	95	97	99	100	125	150	175	200	250	300	350	400	500 1000];
% omega = [0.50797	0.50797	0.50797	0.50797	0.50797	0.50797	0.50797	0.50797	0.50797	0.50797	0.50804	0.50807	0.54433	0.863523095	0.8677499111	0.8705510669	0.8830549936	0.8606774587	0.8619892383	0.8743087238	0.8764810926	0.8748611497	0.8825161149	0.8870739624	0.896972898	0.9015790757	0.8999011183	0.9013839963	0.894473557	0.8997971241	0.8983198944	0.9039067094	0.9056011719	0.9065708387	0.9070248881	0.9113785466	0.9200827745	0.9189882706	0.9217537744	0.9251143808	0.9255604728	0.9269127925	0.9297284522	0.9294741796	0.9279060488	0.9318814024	0.9301400304	0.9351236809	0.9352783132	0.9352611989	0.9397195288	0.9416066054	0.944158116	0.9449163379	0.9433798027	0.9438761788	0.9421268902	0.9457835852	0.947045745	0.9469749568	0.9460528496	0.9497398926	0.9490594212	0.9477029396	0.9505229664	0.9521998022	0.952147985	0.9540975434	0.9524408798	0.9510083223	0.9537683204	0.9525484259	0.95359051	0.9558485958	0.9544659567	0.9548824886	0.9548821389	0.9569488349	0.9584727415	0.9629452479	0.9691821524	0.9706395918	0.9724915027	0.9760579526	0.9793251351	0.9811712233	0.9830822416	0.9864987263 0.9907];

% N_3d = [15 16	17	18	19	20	21	22	23	24	25	26	27	28	29	30	31	32	33	34	35	36	37	38	39	40	41	42	43	44	45	46	47	48	49	50	51	53	55	57	59	60	61	63	65	67	69	70	71	73	75	77	79	80	81	83	85	87	89	90	91	93	95	97	99	100	125	150	175	200	250	300	350	400	500];
% omega_3d = [0.863523095	0.8677499111	0.8705510669	0.8830549936	0.8606774587	0.8619892383	0.8743087238	0.8764810926	0.8748611497	0.8825161149	0.8870739624	0.896972898	0.9015790757	0.8999011183	0.9013839963	0.894473557	0.8997971241	0.8983198944	0.9039067094	0.9056011719	0.9065708387	0.9070248881	0.9113785466	0.9200827745	0.9189882706	0.9217537744	0.9251143808	0.9255604728	0.9269127925	0.9297284522	0.9294741796	0.9279060488	0.9318814024	0.9301400304	0.9351236809	0.9352783132	0.9352611989	0.9397195288	0.9416066054	0.944158116	0.9449163379	0.9433798027	0.9438761788	0.9421268902	0.9457835852	0.947045745	0.9469749568	0.9460528496	0.9497398926	0.9490594212	0.9477029396	0.9505229664	0.9521998022	0.952147985	0.9540975434	0.9524408798	0.9510083223	0.9537683204	0.9525484259	0.95359051	0.9558485958	0.9544659567	0.9548824886	0.9548821389	0.9569488349	0.9584727415	0.9629452479	0.9691821524	0.9706395918	0.9724915027	0.9760579526	0.9793251351	0.9811712233	0.9830822416	0.9864987263];
% [p,S] = polyfit(N_3d,omega_3d,-1);
% R = 1 - (S.normr/norm(omega_3d - mean(omega_3d)))^2
% f = polyval(p,N_3d);
% plot(N_3d, omega_3d, 'x', N_3d, f, '-')




